<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Habit Tracker - Pro Dashboard</title>

<style>
:root{
  --bg:#070b1a;
  --card:#0b122e;
  --card2:#020617;
  --accent:#22c55e;
  --accent2:#4ade80;
  --danger:#ef4444;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --highlight-bg: rgba(34, 197, 94, 0.12);
}
.light{
  --bg:#f8fafc;
  --card:#ffffff;
  --card2:#f1f5f9;
  --accent:#16a34a;
  --accent2:#22c55e;
  --text:#020617;
  --muted:#475569;
  --highlight-bg: rgba(22, 163, 74, 0.1);
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Inter,Arial,sans-serif;
  background:radial-gradient(circle at top,var(--card),var(--bg) 60%);
  color:var(--text);
  min-height: 100vh;
}

.container{max-width:1300px;margin:auto;padding:24px}

/* HEADER & QUOTE */
.header{
  display:grid;
  grid-template-columns: 200px 1fr 350px;
  gap:14px;
  align-items:center;
  margin-bottom: 20px;
}

.quote-container {
  text-align: center;
  min-height: 24px;
}

.quote{
  display: inline-block;
  font-size:14px;
  font-weight: 500;
  color:var(--accent2);
  opacity:0;
  animation:fadeQuote 4s infinite;
}

@keyframes fadeQuote{
  0%{opacity:0;transform:translateY(6px)}
  10%{opacity:1;transform:translateY(0)}
  80%{opacity:1;transform:translateY(0)}
  100%{opacity:0;transform:translateY(-6px)}
}

.header-controls {
  display: flex;
  gap: 8px;
  align-items: center;
  justify-content: flex-end;
}

/* BUTTONS */
button{
  padding:8px 14px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-weight:600;
  transition: all 0.2s;
}
button:active { transform: scale(0.95); }

.primary{background:#38bdf8;color:#020617}
.secondary{background:var(--card);color:var(--text);border:1px solid var(--card2)}

.today-btn{
  background:var(--accent);
  color:#ffffff; 
  min-width: 120px;
  box-shadow: 0 4px 12px rgba(34, 197, 94, 0.2);
}
.light .today-btn {
  background: #dcfce7;
  color: #166534;
  border: 1px solid #bbf7d0;
}

.theme-btn{background:var(--card);border:1px solid var(--card2); font-size: 18px;}

/* CARDS */
.card{
  background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.01)),var(--card);
  border-radius:18px;
  padding:20px;
}

/* PROGRESS */
.progress{
  height:18px;
  background:var(--card2);
  border-radius:12px;
  overflow:hidden;
  position:relative;
  margin-top: 8px;
}
.progress-bar{
  height:100%;
  background:linear-gradient(90deg, var(--accent), var(--accent2));
  transition:width .5s ease;
}
.progress-text{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:10px;
  font-weight:700;
}

/* TABLE STYLING */
.table-wrapper{
  overflow-x:auto; 
  border-radius: 12px;
  border: 1px solid var(--card2);
}
table{
  border-collapse:separate;
  border-spacing: 0;
  min-width:100%;
}
th,td{
  border-right: 1px solid var(--card2);
  border-bottom: 1px solid var(--card2);
  padding:12px;
  font-size:12px;
  text-align:center;
  min-width: 40px;
}

/* HABIT COLUMN FREEZE */
.habit-col {
  position: sticky !important;
  left: 0 !important;
  background: var(--card) !important;
  min-width: 180px !important;
  text-align: left !important;
  z-index: 10 !important;
  font-weight: 600;
  /* Simple, clean vertical divider */
  border-right: 1.5px solid var(--card2) !important; 
}

/* TODAY HIGHLIGHT - BACKGROUND ONLY */
.today-highlight {
  background: var(--highlight-bg) !important;
}

/* DELETE BUTTON (TRASH ICON) */
.habit-cell-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.delete-btn {
  background: transparent;
  color: var(--danger);
  padding: 6px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0.5;
  transition: all 0.2s;
}
.delete-btn:hover {
  background: rgba(239, 68, 68, 0.1);
  opacity: 1;
  transform: scale(1.1);
}

/* WEEKLY CARDS */
.weeks-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 20px;
}
.week-card {
  background: var(--card);
  border: 1px solid var(--card2);
  border-radius: 18px;
  padding: 20px;
  transition: all 0.4s;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  overflow: hidden;
}
.week-card:hover { transform: translateY(-5px); border-color: var(--accent); }
.circle-stat {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  font-weight: 800;
  margin: 15px 0;
}
.week-details {
  width: 100%;
  max-height: 0;
  opacity: 0;
  overflow: hidden;
  transition: all 0.4s ease;
}
.week-card:hover .week-details {
  max-height: 1000px;
  opacity: 1;
  margin-top: 15px;
  padding-top: 15px;
  border-top: 1px solid var(--card2);
}

/* TODAY MODE VIEW */
.today-list { display: flex; flex-direction: column; gap: 12px; max-width: 600px; margin: 0 auto; }
.today-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--card);
  padding: 20px;
  border-radius: 15px;
  border: 1px solid var(--card2);
  transition: all 0.3s;
}
.today-item.completed { border-color: var(--accent); background: rgba(34, 197, 94, 0.05); }

.hidden { display: none !important; }

@media(max-width:900px){
  .header { grid-template-columns: 1fr; }
  .header-controls { justify-content: center; }
}
</style>
</head>

<body>
<div class="container">

  <!-- HEADER -->
  <div class="header">
    <h1>ArohanPro</h1>
    <div class="quote-container">
      <div class="quote" id="quote"></div>
    </div>
    <div class="header-controls">
      <button class="today-btn" id="viewToggleBtn">Today Mode</button>
      <button class="theme-btn" id="themeBtn">üåô</button>
      <button class="secondary" id="exportBtn" onclick="exportData()">Export</button>
      <button class="secondary" id="importBtn" onclick="document.getElementById('fileInput').click()">Import</button>
      <input type="file" id="fileInput" style="display:none" accept=".json" onchange="importData(event)">
    </div>
  </div>

  <!-- DASHBOARD VIEW -->
  <div id="dashboardContainer">
    <div class="card" style="display:flex; justify-content:center; align-items:center; margin-bottom: 24px; padding: 15px;">
        <button class="secondary" id="prevMonth">‚Üê</button>
        <h2 id="monthDisplay" style="margin:0; min-width: 200px; text-align: center;">Month Year</h2>
        <button class="secondary" id="nextMonth">‚Üí</button>
    </div>

    <section style="margin-bottom: 24px;">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <h3>Habit Tracker</h3>
        <div style="display:flex; gap:10px;">
          <input id="habitInput" type="text" placeholder="New habit..." style="padding:8px 12px; border-radius:8px; border:1px solid var(--card2); background:var(--card2); color:inherit;">
          <button class="primary" id="addBtn">Add</button>
        </div>
      </div>
      <div class="card table">
        <div class="table-wrapper">
          <table id="habitTable">
            <thead id="thead"></thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section style="margin-bottom: 24px;">
      <div class="card">
         <h3 style="margin-top:0">Monthly Progress</h3>
         <div class="progress" style="height: 35px;">
           <div class="progress-bar" id="monthBar"></div>
           <div class="progress-text" id="monthText" style="font-size: 14px;">0%</div>
         </div>
         <div style="margin-top: 15px; display: flex; gap: 30px;">
           <div>üèÜ Best: <span id="bestHabit" style="font-weight:bold; color:var(--accent2)">-</span></div>
           <div>‚ö†Ô∏è Needs Work: <span id="worstHabit" style="font-weight:bold; color:var(--danger)">-</span></div>
         </div>
      </div>
    </section>

    <section>
      <h3>Weekly Dashboard <small style="font-weight:normal; color:var(--muted); margin-left:10px;">(Hover to expand)</small></h3>
      <div class="weeks-container" id="weeksContainer"></div>
    </section>
  </div>

  <div id="todayContainer" class="hidden">
    <div class="card" style="max-width:600px; margin: 0 auto 30px auto; text-align:center;">
       <h2 style="margin:0;">Focus: Today</h2>
       <p id="todayDateDisplay" style="color:var(--accent2); font-weight: bold; margin: 10px 0;"></p>
       <p style="color:var(--muted)">Stay consistent</p>
    </div>
    <div class="today-list" id="todayList"></div>
  </div>

</div>

<script>
/* Elements */
const quoteEl = document.getElementById('quote');
const themeBtn = document.getElementById('themeBtn');
const viewToggleBtn = document.getElementById('viewToggleBtn');
const dashboardContainer = document.getElementById('dashboardContainer');
const todayContainer = document.getElementById('todayContainer');
const monthDisplay = document.getElementById('monthDisplay');
const thead = document.getElementById('thead');
const tbody = document.getElementById('tbody');
const weeksContainer = document.getElementById('weeksContainer');
const todayDateDisplay = document.getElementById('todayDateDisplay');

/* State */
let currentDate = new Date();
let habitData = JSON.parse(localStorage.getItem('habitSyncData')) || {};
let currentTheme = localStorage.getItem('habitTheme') || 'dark';
let isTodayMode = false;

const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
const quotes = ["Small wins lead to big victories.", "Consistency is key.", "Don't break the chain.", "Discipline > Motivation.", "Action is the foundation.", "Your future self will thank you.", "Win the morning, win the day."];

function getMonthKey(date) { return `${date.getFullYear()}-${date.getMonth()}`; }
function getDaysInMonth(year, month) { return new Date(year, month + 1, 0).getDate(); }

function initMonthData(key) {
  if (!habitData[key]) {
    const keys = Object.keys(habitData).sort();
    const lastKey = keys[keys.length - 1];
    const baseHabits = lastKey ? habitData[lastKey].map(h => h.name) : ["Exercise", "Reading", "Water"];
    const [year, month] = key.split('-').map(Number);
    habitData[key] = baseHabits.map(name => ({ name, days: Array(getDaysInMonth(year, month)).fill(false) }));
  }
}

function render() {
  const key = getMonthKey(currentDate);
  initMonthData(key);
  monthDisplay.textContent = `${months[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
  renderTable(key);
  renderWeeklyDashboard(key);
  renderTodayMode();
  updateStats(key);
}

function renderTable(key) {
  const habits = habitData[key];
  const [year, month] = key.split('-').map(Number);
  const days = getDaysInMonth(year, month);
  const now = new Date();
  const isCurrentMonth = now.getMonth() === month && now.getFullYear() === year;
  const todayIdx = now.getDate();

  // THEAD
  let headHtml = `<tr><th class="habit-col">Habit</th>`;
  for(let i=1; i<=days; i++) {
    const isToday = isCurrentMonth && i === todayIdx;
    headHtml += `<th class="${isToday ? 'today-highlight' : ''}">${i}</th>`;
  }
  headHtml += `</tr>`;
  thead.innerHTML = headHtml;
  
  // TBODY
  tbody.innerHTML = "";
  habits.forEach((h, hIdx) => {
    const tr = document.createElement("tr");
    
    // Habit Column (Sticky)
    let rowHtml = `
      <td class="habit-col">
        <div class="habit-cell-content">
          <span>${h.name}</span>
          <button class="delete-btn" onclick="deleteHabit(${hIdx})" title="Delete Habit">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
              <path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"/>
            </svg>
          </button>
        </div>
      </td>`;

    // Days Columns
    h.days.forEach((checked, dIdx) => {
      const isToday = isCurrentMonth && (dIdx + 1) === todayIdx;
      rowHtml += `
        <td class="${isToday ? 'today-highlight' : ''}">
          <input type="checkbox" ${checked ? 'checked' : ''} onchange="toggleHabit('${key}', ${hIdx}, ${dIdx})">
        </td>`;
    });
    
    tr.innerHTML = rowHtml;
    tbody.appendChild(tr);
  });
}

function renderTodayMode() {
  const today = new Date();
  const key = getMonthKey(today);
  const dayIdx = today.getDate() - 1;
  initMonthData(key);
  
  todayDateDisplay.textContent = today.toDateString();
  
  todayList.innerHTML = (habitData[key] || []).map((h, hIdx) => `
    <div class="today-item ${h.days[dayIdx] ? 'completed' : ''}">
      <span style="font-size:18px; font-weight:600">${h.name}</span>
      <input type="checkbox" style="transform:scale(1.8)" ${h.days[dayIdx] ? 'checked' : ''} onchange="toggleHabit('${key}', ${hIdx}, ${dayIdx})">
    </div>
  `).join('');
}

function renderWeeklyDashboard(key) {
  weeksContainer.innerHTML = "";
  const habits = habitData[key];
  const [year, month] = key.split('-').map(Number);
  const days = getDaysInMonth(year, month);
  
  for (let i = 0; i < days; i += 7) {
    const start = i, end = Math.min(i + 6, days - 1);
    let t = 0, d = 0;
    const hStats = habits.map(h => {
      let ht = 0, hd = 0;
      for(let j=start; j<=end; j++) { ht++; t++; if(h.days[j]) { hd++; d++; } }
      return { name: h.name, p: Math.round(hd/ht*100) || 0 };
    });
    const totalP = Math.round(d/t*100) || 0;

    const card = document.createElement("div");
    card.className = "week-card";
    card.innerHTML = `
      <div style="width:100%; display:flex; justify-content:space-between; font-weight:bold; color:var(--muted); font-size:12px">
        <span>WEEK ${Math.floor(i/7)+1}</span>
        <span>Days ${start+1}-${end+1}</span>
      </div>
      <div class="circle-stat" style="background: radial-gradient(circle, var(--card) 60%, transparent 60%), conic-gradient(var(--accent) ${totalP}%, var(--card2) 0%)">
        ${totalP}%
      </div>
      <div class="week-details">
        ${hStats.map(hs => `
          <div style="margin-bottom:10px">
            <div style="display:flex; justify-content:space-between; font-size:11px; margin-bottom:4px"><span>${hs.name}</span><span>${hs.p}%</span></div>
            <div class="progress"><div class="progress-bar" style="width:${hs.p}%"></div></div>
          </div>
        `).join('')}
      </div>
    `;
    weeksContainer.appendChild(card);
  }
}

function updateStats(key) {
  const habits = habitData[key] || [];
  let t = 0, d = 0;
  if(!habits.length) {
    document.getElementById('monthBar').style.width = "0%";
    document.getElementById('monthText').textContent = "0%";
    document.getElementById('bestHabit').textContent = "-";
    document.getElementById('worstHabit').textContent = "-";
    return;
  }
  
  const scores = habits.map(h => {
    const done = h.days.filter(Boolean).length;
    t += h.days.length; d += done;
    return { name: h.name, s: done / h.days.length };
  }).sort((a,b) => b.s - a.s);

  const p = t ? Math.round(d/t*100) : 0;
  document.getElementById('monthBar').style.width = p + "%";
  document.getElementById('monthText').textContent = p + "% Completed";
  document.getElementById('bestHabit').textContent = scores[0].name;
  document.getElementById('worstHabit').textContent = scores[scores.length-1].name;
}

/* Actions */
viewToggleBtn.onclick = () => {
  isTodayMode = !isTodayMode;
  viewToggleBtn.textContent = isTodayMode ? "Month View" : "Today Mode";
  dashboardContainer.classList.toggle('hidden', isTodayMode);
  todayContainer.classList.toggle('hidden', !isTodayMode);
  if(isTodayMode) renderTodayMode(); else render();
};

window.toggleHabit = (key, hIdx, dIdx) => {
  habitData[key][hIdx].days[dIdx] = !habitData[key][hIdx].days[dIdx];
  localStorage.setItem('habitSyncData', JSON.stringify(habitData));
  if(isTodayMode) renderTodayMode(); else render();
};

window.deleteHabit = (idx) => {
  const key = getMonthKey(currentDate);
  if(confirm(`Delete "${habitData[key][idx].name}"?`)) {
    habitData[key].splice(idx, 1);
    localStorage.setItem('habitSyncData', JSON.stringify(habitData));
    render();
  }
};

document.getElementById('addBtn').onclick = () => {
  const v = document.getElementById('habitInput').value.trim();
  if(!v) return;
  const key = getMonthKey(currentDate);
  const [year, month] = key.split('-').map(Number);
  habitData[key].push({ name: v, days: Array(getDaysInMonth(year, month)).fill(false) });
  document.getElementById('habitInput').value = "";
  localStorage.setItem('habitSyncData', JSON.stringify(habitData));
  render();
};

document.getElementById('prevMonth').onclick = () => { currentDate.setMonth(currentDate.getMonth()-1); render(); };
document.getElementById('nextMonth').onclick = () => { currentDate.setMonth(currentDate.getMonth()+1); render(); };

themeBtn.onclick = () => {
  currentTheme = document.body.classList.contains("light") ? "dark" : "light";
  document.body.classList.toggle('light', currentTheme === 'light');
  themeBtn.textContent = currentTheme === 'light' ? "üåû" : "üåô";
  localStorage.setItem('habitTheme', currentTheme);
};

function exportData() {
  const blob = new Blob([JSON.stringify(habitData)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `habitsync-backup-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
}

function importData(e) {
  const reader = new FileReader();
  reader.onload = (event) => {
    try {
      const data = JSON.parse(event.target.result);
      habitData = data;
      localStorage.setItem('habitSyncData', JSON.stringify(habitData));
      render();
    } catch(err) { alert("Invalid backup file."); }
  };
  reader.readAsText(e.target.files[0]);
}

/* Quote Rotation */
let qIdx = 0;
function rotateQuote() {
  quoteEl.style.animation = 'none';
  void quoteEl.offsetWidth; 
  quoteEl.style.animation = 'fadeQuote 4s infinite';
  quoteEl.textContent = quotes[qIdx];
  qIdx = (qIdx + 1) % quotes.length;
}
setInterval(rotateQuote, 4000);
rotateQuote();

// Init
if(currentTheme === 'light') document.body.classList.add('light');
render();
</script>
</body>
</html>